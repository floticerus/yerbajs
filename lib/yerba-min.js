/*
 yerbajs - simple javascript data management
  @copyright 2014 Kevin von Flotow <vonflow@gmail.com>
  @license MIT License <http://opensource.org/licenses/MIT>
*/
(function(){(function(f,d){function b(a){if(this._init)return this._init(a)}var e=Date.prototype.toISOString?"toISOString":"getTime";f.extend(b,{_$:f,logLevel:3,brew:function(a){return new b(a)},isYerba:function(a){return a instanceof b},set:function(a,c){b.hasOwnProperty(a)&&(this[a]=c)}});b.prototype={_init:function(a){a=a||[];this.indices={_id:{}};this.length=this.lastUpdate=0;this.add(a);3>=b.logLevel?this.log(3,"yerba initialized"):this.log(4,JSON.stringify(this));return this},brew:function(a){return this._init(a)},
_setLastUpdate:function(){this.lastUpdate=(new Date)[e]()},_generateUID:function(){for(var a=f.genUID();this.indices._id.hasOwnProperty(a);)a=f.genUID();return a},_reIndex:function(){this.indices={_id:{}};this.each(function(a,c){this.indices._id[c._id]=a});return this},log:function(a,c){return a<=b.logLevel?console.log("yerba:"+a+":> "+c):!1},set:function(a,c){f.hasOwnProperty(a)&&(f[a]=c);this.hasOwnProperty(a)&&(this[a]=c)},each:function(a){for(var c=0,d=this.length;c<d;++c){var b=a.call(this,c,
this[c]);if(!b&&"undefined"!==typeof b)break}return this},get:function(a){return this.indices._id.hasOwnProperty(a)?this[this.indices._id[a]]:!1},find:function(a){if(!a)return!1;var c=d,b={},e=function(a){};f.isFunction(a)?e=a:(c="undefined"!==typeof a.query?a.query:c,b=a.opts||b,e=a.done||e);b.caseSensitive="undefined"!==typeof b.caseSensitive?b.caseSensitive:!0;b.limit="undefined"!==typeof b.limit&&f.isNumber(b.limit)?b.limit|0:0;var h=[];this.each(function(a,d){var e=0,k=0;if(f.isString(c)||f.isNumber(c))e=
1,"undefined"!==typeof d.data&&d.data==c&&(k=1);else for(var g in c)d.hasOwnProperty(g)&&(b.caseSensitive&&d[g]===c[g]||!b.caseSensitive&&d[g].toLowerCase()===c[g].toLowerCase())&&k++,e++;if(k===e&&(h.push(d),0<b.limit&&h.length>=b.limit))return!1});e.call(this,h);return this},shuffle:function(){for(var a=this.length,c,b;0<--a;)c=Math.random()*(a+1)|0,b=this[c],this[c]=this[a],this[a]=b;return this},clone:function(){return this.slice(0)},random:function(){var a=this.clone().shuffle();return a[Math.random()*
a.length|0]},addOne:function(a){a={data:a};a._id=a.data._id||this._generateUID();if(this.indices._id.hasOwnProperty(a._id))this[this.indices._id[a._id]]=a;else{var c=this.length++;this[c]=a;this.indices._id[a._id]=c}this._setLastUpdate();return this},add:function(a){for(var c=0,b=a.length;c<b;++c)this.addOne(a[c]);return this},toArray:function(){return f.toArray(this)},slice:function(a,c){return new b(Array.prototype.slice.call(this,a,c))},pop:function(){var a=Array.prototype.pop.call(this);this._reIndex();
return a},shift:function(){var a=Array.prototype.shift.call(this);this._reIndex();return a},flush:function(){this.each(function(a,b){delete this[a]});return this._init()},merge:function(a){b.isYerba(a)&&(a=[a]);for(var c=[],d=0,e=a.length;d<e;++d)b.isYerba(a[d])&&a[d].each(function(a,b){c.push(b.data)});this.add(c);return this}};if("undefined"!==typeof module&&module.exports)module.exports=b;else if(window)window.yerba=b;else return b})(new (function(){function f(){this._init()}f.prototype={_init:function(){this.logging=
!0},isFunction:function(d){return"[object Function]"===Object.prototype.toString.call(d)},isString:function(d){return"string"===typeof d||d instanceof String},isNumber:function(d){return!isNaN(parseFloat(d))&&isFinite(d)},isObject:function(d){return d===Object(d)&&"[object Array]"!==Object.prototype.toString.call(d)},isArray:Array.isArray||function(d){return"[object Array]"===Object.prototype.toString.call(d)},toArray:function(d){for(var b=[],e=0,a=d.length;e<a;++e)b.push(d[e]);return b},extend:function(){var d=
this.toArray(arguments),b=d[0]||[];if(2<=d.length)for(var e=1,a=d.length;e<a;++e)if("undefined"!==typeof d[e])for(var c in d[e])"undefined"!==typeof c&&(b[c]=d[e][c])},genUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var b=16*Math.random()|0;return("x"===d?b:b&3|8).toString(16)})}};return f}()),void 0)})();
