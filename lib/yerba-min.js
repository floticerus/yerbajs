/*
 yerbajs - simple javascript data management
  @copyright 2014 Kevin von Flotow <vonflow@gmail.com>
  @license MIT License <http://opensource.org/licenses/MIT>
*/
(function(){(function(e,b){function c(a){if(this._init)return this._init(a)}var d=Date.prototype.toISOString?"toISOString":"getTime",g={_$:e,logLevel:3};c.prototype={_init:function(a){a=a||[];this.indices={_id:{}};this.length=this.lastUpdate=0;this.add(a);3>=c.logLevel?this.log(3,"yerba initialized"):this.log(4,JSON.stringify(this));return this},_setLastUpdate:function(){this.lastUpdate=(new Date)[d]()},_generateId:function(){for(var a=e.genId();this.indices._id.hasOwnProperty(a);)a=e.genId();return a},
_resetIndex:function(){this.indices={_id:{}};this.each(function(a,f){this.indices._id[f._id]=a});return this},log:function(a,f){return a<=c.logLevel?console.log("yerba:"+a+":> "+f):!1},set:function(a,f){e.hasOwnProperty(a)&&(e[a]=f);this.hasOwnProperty(a)&&(this[a]=f)},each:function(a){for(var f=0,b=this.length;f<b;++f){var c=a.call(this,f,this[f]);if(!c&&"undefined"!==typeof c)break}return this},getDataById:function(a){return this.indices._id.hasOwnProperty(a)?this[this.indices._id[a]]:!1},find:function(a){if(!a)return!1;
var f=b,c={},d=function(a){};e.isFunction(a)?d=a:(f="undefined"!==typeof a.query?a.query:f,c=a.opts||c,d=a.done||d);c.caseSensitive="undefined"!==typeof c.caseSensitive?c.caseSensitive:!0;c.limit="undefined"!==typeof c.limit&&e.isNumber(c.limit)?c.limit|0:0;var g=[];this.each(function(a,b){var d=0,k=0;if(e.isString(f)||e.isNumber(f))d=1,"undefined"!==typeof b.data&&b.data==f&&(k=1);else for(var h in f)b.hasOwnProperty(h)&&(c.caseSensitive&&b[h]===f[h]||!c.caseSensitive&&b[h].toLowerCase()===f[h].toLowerCase())&&
k++,d++;if(k===d&&(g.push(b),0<c.limit&&g.length>=c.limit))return!1});d.call(this,g);return this},shuffle:function(){for(var a=this.length,b,c;0<--a;)b=Math.random()*(a+1)|0,c=this[b],this[b]=this[a],this[a]=c;this._resetIndex();return this},clone:function(){return this.slice(0)},random:function(){var a=this.clone().shuffle();return a[Math.random()*a.length|0]},addOne:function(a){a={data:a};a._id=a.data._id||this._generateId();if(this.indices._id.hasOwnProperty(a._id))this[this.indices._id[a._id]]=
a;else{var b=this.length++;this[b]=a;this.indices._id[a._id]=b}this._setLastUpdate();return this},add:function(a){e.isArray(a)||(a=[a]);for(var b=0,c=a.length;b<c;++b)this.addOne(a[b]);return this},toArray:function(){return e.toArray(this)},slice:function(a,b){return new c(Array.prototype.slice.call(this,a,b))},pop:function(){var a=Array.prototype.pop.call(this);this._resetIndex();return a},shift:function(){var a=Array.prototype.shift.call(this);this._resetIndex();return a},flush:function(){this.each(function(a,
b){delete this[a]});return this._init()},merge:function(a){c.isYerba(a)&&(a=[a]);for(var b=[],d=0,e=a.length;d<e;++d)c.isYerba(a[d])&&a[d].each(function(a,c){b.push(c.data)});this.add(b);return this}};e.extend(c,g,{brew:function(a){return new c(a)},isYerba:function(a){return a instanceof c},set:function(a,b){c.hasOwnProperty(a)&&(this[a]=b)}},{fn:c.prototype});"undefined"!==typeof module&&module.exports?module.exports=c:"undefined"!==typeof window&&(window.yerba=c)})(new (function(){function e(){this._init()}
e.prototype={_init:function(){this.logging=!0},isFunction:function(b){return"[object Function]"===Object.prototype.toString.call(b)},isString:function(b){return"string"===typeof b||b instanceof String},isNumber:function(b){return!isNaN(parseFloat(b))&&isFinite(b)},isObject:function(b){return b===Object(b)&&"[object Array]"!==Object.prototype.toString.call(b)},isArray:Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)},toArray:function(b){for(var c=[],d=0,e=b.length;d<
e;++d)c.push(b[d]);return c},extend:function(){var b=this.toArray(arguments);1===b.length&&this.isArray(b[0])&&(b=b[0]);var c=b[0]||[];if(2<=b.length)for(var d=1,e=b.length;d<e;++d)if("undefined"!==typeof b[d])for(var a in b[d])"undefined"!==typeof a&&(c[a]=b[d][a]);return c},genId:function(b){var c=0;b=(b||16)-1;for(var d=(26*Math.random()+10|0).toString(36);c<b;++c){var e=36*Math.random()|0,a=e.toString(36);9<e&&1===(Math.random()+0.3|0)&&(a=a.toUpperCase());d+=a}return d}};return e}()),void 0)})();
