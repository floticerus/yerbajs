/*
 yerbajs - simple javascript data management
  @copyright 2014 Kevin von Flotow <vonflow@gmail.com>
  @license MIT License <http://opensource.org/licenses/MIT>
*/
(function(){(function(f,g){function a(d){if(this._init)return this._init(d)}function c(d){d=d||[];this.indices={_id:{}};for(var l=this.length=this.lastUpdate=0,b=d.length;l<b;l++)this.add(d[l]);3>=a.logLevel?this.log(3,"yerba initialized"):this.log(4,JSON.stringify(this))}function b(d){if(!d)return!1;var a=g,b={},c=function(d){};isFunction(d)?c=d:(a="undefined"!==typeof d.query?d.query:a,b=d.opts||b,c=d.done||c);b.caseSensitive="undefined"!==typeof b.caseSensitive?b.caseSensitive:!0;b.limit="undefined"!==
typeof b.limit&&f.isNumber(b.limit)?b.limit|0:0;var e=[];this.each(function(d,c){var h=0,g=0;if(f.isString(a)||f.isNumber(a))h=1,"undefined"!==typeof c.data&&c.data==a&&(g=1);else for(var k in a)c.hasOwnProperty(k)&&(b.caseSensitive&&c[k]===a[k]||!b.caseSensitive&&c[k].toLowerCase()===a[k].toLowerCase())&&g++,h++;if(g===h&&(e.push(c),0<b.limit&&e.length>=b.limit))return!1});c.call(this,e);return this}function e(){for(var d=0,a=arguments.length;d<a;++d)this.addOne(arguments[d]);return this}function h(){var d=
Array.prototype.pop.call(this);this._reIndex();return d}function m(){this.each(function(d,a){delete this[d]});return this._init()}function n(){for(var d=this.length,a,b;0<--d;)a=Math.random()*(d+1)|0,b=this[a],this[a]=this[d],this[d]=b;return this}var p=Date.prototype.toISOString?"toISOString":"getTime";a.prototype={_init:c,brew:c,_setLastUpdate:function(){this.lastUpdate=(new Date)[p]()},_generateUID:function(){for(var a=f.genUID();this.indices._id.hasOwnProperty(a);)a=f.genUID();return a},_reIndex:function(){this.indices=
{_id:{}};this.each(function(a,b){this.indices._id[b._id]=a});return this},log:function(d,b){return d<=a.logLevel?console.log("yerba:"+d+":> "+b):!1},set:function(a,b){f.hasOwnProperty(a)&&(f[a]=b);this.hasOwnProperty(a)&&(this[a]=b)},each:function(a){for(var b=0,c=this.length;b<c;++b){var e=a.call(this,b,this[b]);if(!e&&"undefined"!==typeof e)break}return this},get:function(a){return this.indices._id.hasOwnProperty(a)?this[this.indices._id[a]]:!1},find:b,bombilla:b,shuffle:n,stir:n,clone:function(){return this.slice(0)},
random:function(){var a=this.clone().shuffle();return a[Math.random()*a.length|0]},addOne:function(a){a={data:a};a._id=a.data._id||this._generateUID();if(this.indices._id.hasOwnProperty(a._id))this[this.indices._id[a._id]]=a;else{var b=this.length++;this[b]=a;this.indices._id[a._id]=b}this._setLastUpdate();return this},add:e,pour:e,toArray:function(){return f.toArray(this)},slice:function(b,c){return new a(Array.prototype.slice.call(this,b,c))},pop:h,sip:h,shift:function(){var a=Array.prototype.shift.call(this);
this._reIndex();return a},flush:m,spill:m,extend:function(){for(var b=0,c=arguments.length;b<c;++b)console.log(a.isYerba(arguments[b])),"yerba"===typeof arguments[b]&&console.log("yerbaaa")}};a.isYerba=function(b){return b instanceof a};a.set=function(b,c){a.hasOwnProperty(b)&&(this[b]=c)};a._$=f;a.logLevel=3;if("undefined"!==typeof module&&module.exports)module.exports=a;else if(window)window.yerba=a;else return a})(new (function(){function f(){this._init()}var g=Object.create||function(){function a(){}
return function(c){if(1!=arguments.length)throw Error("Object.create implementation only accepts one parameter.");a.prototype=c;return new a}}();f.prototype={_init:function(){this.logging=!0},genUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return("x"===a?c:c&3|8).toString(16)})},isFunction:function(a){return"[object Function]"===Object.prototype.toString.call(a)},isString:function(a){return"string"===typeof a||a instanceof String},
isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isObject:function(a){return a===Object(a)&&"[object Array]"!==Object.prototype.toString.call(a)},isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},toArray:function(a){for(var c=[],b=0,e=a.length;b<e;++b)c.push(a[b]);return c},each:function(a,c){if(!a)return!1;if(!c)return this.nhLog("each: callback is required");if(!this.isFunction(c))return this.nhLog("each: callback must be a function");if(Array.isArray(a))for(var b=
0,e=a.length;b<e;b++)c.call(a,b,a[b]);else if(a===Object(a))for(b in a)c.call(a,b,a[b]);else if(this.isNumber(a))for(b=0;b<a;b++)c.call(a,b);else if(this.isString(a))for(b=0,e=a.length;b<e;b++)c.call(a,b,a.charAt(b));else this.nhLog("each: invalid type")},extend:function(){var a=arguments;if(0===a.length)return!1;for(var c=0,b=a.length,e=g(a[0]);c<b;c++)for(var f in a[c])e[f]=a[c][f];return e}};return f}()),void 0)})();
