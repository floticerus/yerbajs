/*
 yerbajs - simple javascript data management
  @copyright 2014 Kevin von Flotow <vonflow@gmail.com>
  @license MIT License <http://opensource.org/licenses/MIT>
*/
(function(){(function(e,c){function d(){}function b(a){if(this._init)return this._init(a)}var g=Date.prototype.toISOString?"toISOString":"getTime";d.prototype={_$:e,logLevel:3,brew:function(a){return new b(a)},isYerba:function(a){return a instanceof b},set:function(a,f){b.hasOwnProperty(a)&&(this[a]=f)}};b.prototype={_init:function(a){a=a||[];this.idName="_id";this.idLength=8;this.length=this.lastUpdate=0;this._resetIndices();"undefined"!==typeof a&&this.add(a);3>=b.logLevel?this.log(3,"yerba initialized"):
this.log(4,JSON.stringify(this));return this},_setLastUpdate:function(){this.lastUpdate=(new Date)[g]()},_generateId:function(){for(var a=e.genId(this.idLength);this.indices[this.idName].hasOwnProperty(a);)a=e.genId(this.idLength);return a},_resetIndices:function(){this.indices={};this.indices[this.idName]={};console.log(this.indices);this.each(function(a,f){this.indices[this.idName][f[this.idName]]=a});return this},log:function(a,f){return a<=b.logLevel?console.log("yerba:"+a+":> "+f):!1},set:function(a,
f){this.hasOwnProperty(a)&&(this[a]=f);switch(a){case "idName":this._resetIndices()}},each:function(a){for(var f=0,c=this.length;f<c;++f){var b=a.call(this,f,this[f]);if(!b&&"undefined"!==typeof b)break}return this},getDataById:function(a){return this.indices[this.idName].hasOwnProperty(a)?this[this.indices[this.idName][a]]:!1},find:function(a){if(!a)return!1;var f=c,b={},d=function(a){};e.isFunction(a)?d=a:(f="undefined"!==typeof a.query?a.query:f,b=a.opts||b,d=a.done||d);b.caseSensitive="undefined"!==
typeof b.caseSensitive?b.caseSensitive:!0;b.limit="undefined"!==typeof b.limit&&e.isNumber(b.limit)?b.limit|0:0;var g=[];this.each(function(a,c){var d=0,k=0;if(e.isString(f)||e.isNumber(f))d=1,"undefined"!==typeof c.data&&c.data==f&&(k=1);else for(var h in f)c.hasOwnProperty(h)&&(b.caseSensitive&&c[h]===f[h]||!b.caseSensitive&&c[h].toLowerCase()===f[h].toLowerCase())&&k++,d++;if(k===d&&(g.push(c),0<b.limit&&g.length>=b.limit))return!1});d.call(this,g);return this},shuffle:function(){for(var a=this.length,
b,c;0<--a;)b=Math.random()*(a+1)|0,c=this[b],this[b]=this[a],this[a]=c;this._resetIndices();return this},clone:function(){return this.slice(0)},random:function(){var a=this.clone().shuffle();return a[Math.random()*a.length|0]},addOne:function(a){a={data:a};a[this.idName]=a.data[this.idName]||this._generateId();if(this.indices[this.idName].hasOwnProperty(a[this.idName]))this[this.indices[this.idName][a[this.idName]]]=a;else{var b=this.length++;this[b]=a;this.indices[this.idName][a[this.idName]]=b}this._setLastUpdate();
return this},add:function(a){e.isArray(a)||(a=[a]);for(var b=0,c=a.length;b<c;++b)this.addOne(a[b]);return this},toArray:function(){return e.toArray(this)},slice:function(a,c){return new b(Array.prototype.slice.call(this,a,c))},pop:function(){var a=Array.prototype.pop.call(this);this._resetIndices();return a},shift:function(){var a=Array.prototype.shift.call(this);this._resetIndices();return a},flush:function(){this.each(function(a,b){delete this[a]});this._resetIndices();this.length=this.lastUpdate=
0;return this},merge:function(a){b.isYerba(a)&&(a=[a]);for(var c=[],d=0,e=a.length;d<e;++d)b.isYerba(a[d])&&a[d].each(function(a,b){c.push(b.data)});this.add(c);return this}};e.extend(b,d.prototype,{fn:b.prototype});"undefined"!==typeof module&&module.exports?module.exports=b:"undefined"!==typeof window&&(window.yerba=b)})(new (function(){function e(){this._init()}e.prototype={_init:function(){},isFunction:function(c){return"[object Function]"===Object.prototype.toString.call(c)},isString:function(c){return"string"===
typeof c||c instanceof String},isNumber:function(c){return!isNaN(parseFloat(c))&&isFinite(c)},isObject:function(c){return c===Object(c)&&"[object Array]"!==Object.prototype.toString.call(c)},isArray:Array.isArray||function(c){return"[object Array]"===Object.prototype.toString.call(c)},toArray:function(c){for(var d=[],b=0,e=c.length;b<e;++b)d.push(c[b]);return d},extend:function(){var c=this.toArray(arguments);1===c.length&&this.isArray(c[0])&&(c=c[0]);var d=c[0]||[];if(2<=c.length)for(var b=1,e=c.length;b<
e;++b)if("undefined"!==typeof c[b])for(var a in c[b])"undefined"!==typeof a&&(d[a]=c[b][a]);return d},genId:function(c){var d=0;c=(c||16)-1;for(var b=(26*Math.random()+10|0).toString(36);d<c;++d){var e=36*Math.random()|0,a=e.toString(36);9<e&&1===(Math.random()+0.3|0)&&(a=a.toUpperCase());b+=a}return b}};return e}()),void 0)})();
