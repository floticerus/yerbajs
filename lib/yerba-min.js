/*
 yerbajs - simple javascript data management
  @copyright 2014 Kevin von Flotow <vonflow@gmail.com>
  @license MIT License <http://opensource.org/licenses/MIT>
*/
(function(){function d(a){this._init(a)}function l(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})}function h(a){return"string"===typeof a||a instanceof String}function k(a){return!isNaN(parseFloat(a))&&isFinite(a)}var m=Date.prototype.toISOString?"toISOString":"getTime";d.prototype={_init:function(a){a=a||[];for(var b=this.length=this.lastUpdate=0,c=a.length;b<c;b++)this.add(a[b])},_setLastUpdate:function(){this.lastUpdate=
(new Date)[m]()},_generateUID:function(){var a=l();return this.get(a)?this._generateUID():a},each:function(a){for(var b=0,c=this.length;b<c;++b)a.call(this,b,this[b]);return this},get:function(a){for(var b=0,c=this.length;b<c;++b)if(this[b]._id===a)return this[b];return!1},find:function(a){if(!a)return!1;var b={query:void 0,opts:{},limit:0,done:function(a){}};"[object Function]"===Object.prototype.toString.call(a)?b.done=a:(b.query="undefined"!==typeof a.query?a.query:b.query,b.opts=a.opts||b.opts,
b.limit="undefined"!==typeof a.limit?a.limit:b.limit,b.done=a.done||b.done);b.opts.caseSensitive="undefined"!==typeof b.opts.caseSensitive?b.opts.caseSensitive:!0;var c=[];this.each(function(a,e){var d=0,g=0;if(h(b.query)||k(b.query))d=1,"undefined"!==typeof e.value&&e.value==b.query&&(g=1);else for(var f in b.query)e.hasOwnProperty(f)&&(b.opts.caseSensitive&&e[f]===b.query[f]||!b.opts.caseSensitive&&e[f].toLowerCase()===b.query[f].toLowerCase())&&g++,d++;g===d&&c.push(e)});return b.done(c)},shuffle:function(){for(var a=
this.length,b,c;0<--a;)b=Math.random()*(a+1)|0,c=this[b],this[b]=this[a],this[a]=c;return this},clone:function(){return this.slice(0)},random:function(){var a=this.clone().shuffle();return a[Math.random()*a.length|0]},addOne:function(a){if(h(a)||k(a))a={value:a};a._id=a._id||this._generateUID();if(this.get(a._id))for(var b=0,c=this.length;b<c;++b){if(this[b]._id===a._id){this[b]=a;break}}else this[this.length++]=a;this._setLastUpdate()},add:function(){for(var a=0,b=arguments.length;a<b;++a)this.addOne(arguments[a])},
toArray:function(){var a=[];this.each(function(b,c){a.push(c)});return a},slice:function(a,b){return new d(Array.prototype.slice.call(this,a,b))},pop:function(){return Array.prototype.pop.call(this)},shift:function(){return Array.prototype.shift.call(this)},flush:function(){for(var a=0,b=this.length;a<b;++a)delete this[a];this.length=0}};if("undefined"!==typeof module&&module.exports)module.exports=d;else if(window)window.yerba=d;else return d})();
